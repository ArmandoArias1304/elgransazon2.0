<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>El Gran Sazón - Mi Perfil</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@300;400;500;600;700"
      rel="stylesheet"
    />

    <!-- Sistema de Temas (Modo Claro/Oscuro) -->
    <div th:replace="~{fragments/theme :: themeResources}"></div>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#38e07b",
              "primary-dark": "#2bc866",
              "background-light": "#f8fafc",
              "background-dark": "#0f172a",
            },
            fontFamily: {
              display: ["Work Sans", "sans-serif"],
            },
          },
        },
      };
    </script>
  </head>
  <body
    class="bg-gradient-to-br from-background-light to-gray-50 dark:from-background-dark dark:to-gray-900 font-display text-gray-800 dark:text-gray-200"
  >
    <div class="container mx-auto px-4 py-6 sm:py-8 max-w-4xl">
      <!-- HEADER -->
      <div class="mb-6 sm:mb-8">
        <a
          href="/client/dashboard"
          class="inline-flex items-center gap-2 text-primary hover:text-primary-dark font-semibold mb-4 transition-colors"
        >
          <span class="material-symbols-outlined">arrow_back</span>
          Volver al Dashboard
        </a>
        <div
          class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"
        >
          <div>
            <h1
              class="text-2xl sm:text-4xl font-bold text-gray-900 dark:text-white mb-2"
            >
              Mi Perfil
            </h1>
            <p class="text-gray-600 dark:text-gray-400">
              Actualiza tu información personal
            </p>
          </div>
        </div>
      </div>

      <!-- SUCCESS MESSAGE -->
      <div
        th:if="${successMessage}"
        class="mb-6 rounded-xl bg-green-100 dark:bg-green-900/30 border border-green-200 dark:border-green-800 p-4 flex items-start gap-3"
      >
        <span
          class="material-symbols-outlined text-green-600 dark:text-green-400 text-2xl"
        >
          check_circle
        </span>
        <div>
          <p
            class="font-semibold text-green-800 dark:text-green-300"
            th:text="${successMessage}"
          >
            Perfil actualizado exitosamente
          </p>
        </div>
      </div>

      <!-- ERROR MESSAGE -->
      <div
        th:if="${errorMessage}"
        class="mb-6 rounded-xl bg-red-100 dark:bg-red-900/30 border border-red-200 dark:border-red-800 p-4 flex items-start gap-3"
      >
        <span
          class="material-symbols-outlined text-red-600 dark:text-red-400 text-2xl"
        >
          error
        </span>
        <div>
          <p
            class="font-semibold text-red-800 dark:text-red-300"
            th:text="${errorMessage}"
          >
            Error al actualizar perfil
          </p>
        </div>
      </div>

      <!-- PROFILE FORM -->
      <div
        class="rounded-2xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 shadow-xl overflow-hidden"
      >
        <!-- Form Header -->
        <div
          class="px-6 py-4 bg-gradient-to-r from-primary to-primary-dark flex items-center gap-3"
        >
          <span class="material-symbols-outlined text-white text-3xl">
            account_circle
          </span>
          <h2 class="text-2xl font-bold text-white">Información Personal</h2>
        </div>

        <!-- Form Body -->
        <form
          th:action="@{/client/profile/update}"
          th:object="${profileDTO}"
          method="post"
          class="p-6 sm:p-8"
        >
          <div class="space-y-6">
            <!-- Full Name -->
            <div>
              <label
                for="fullName"
                class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2"
              >
                <span class="flex items-center gap-2">
                  <span class="material-symbols-outlined text-lg">person</span>
                  Nombre Completo
                  <span class="text-red-500">*</span>
                </span>
              </label>
              <input
                type="text"
                id="fullName"
                th:field="*{fullName}"
                class="w-full px-4 py-3 bg-white dark:bg-gray-800 border-2 border-gray-300 dark:border-gray-700 rounded-xl text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
                placeholder="Ingresa tu nombre completo"
                required
              />
              <p
                th:if="${#fields.hasErrors('fullName')}"
                th:errors="*{fullName}"
                class="mt-2 text-sm text-red-600 dark:text-red-400"
              ></p>
            </div>

            <!-- Username -->
            <div>
              <label
                for="username"
                class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2"
              >
                <span class="flex items-center gap-2">
                  <span class="material-symbols-outlined text-lg">badge</span>
                  Nombre de Usuario
                  <span class="text-red-500">*</span>
                </span>
              </label>
              <input
                type="text"
                id="username"
                th:field="*{username}"
                class="w-full px-4 py-3 bg-white dark:bg-gray-800 border-2 border-gray-300 dark:border-gray-700 rounded-xl text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
                placeholder="Ingresa tu nombre de usuario"
                pattern="^[a-zA-Z0-9_]+$"
                title="Solo letras, números y guión bajo"
                required
              />
              <p class="mt-1 text-xs text-gray-600 dark:text-gray-400">
                Solo letras, números y guión bajo (_)
              </p>
              <p
                th:if="${#fields.hasErrors('username')}"
                th:errors="*{username}"
                class="mt-2 text-sm text-red-600 dark:text-red-400"
              ></p>
            </div>

            <!-- Email (Read-only) -->
            <div>
              <label
                for="email"
                class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2"
              >
                <span class="flex items-center gap-2">
                  <span class="material-symbols-outlined text-lg">email</span>
                  Correo Electrónico
                  <span class="text-xs font-normal text-gray-500"
                    >(No editable)</span
                  >
                </span>
              </label>
              <input
                type="email"
                id="email"
                th:value="${customer.email}"
                class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-800 border-2 border-gray-300 dark:border-gray-700 rounded-xl text-gray-500 dark:text-gray-400 cursor-not-allowed"
                readonly
                disabled
              />
              <p class="mt-1 text-xs text-gray-600 dark:text-gray-400">
                El correo electrónico no se puede modificar
              </p>
            </div>

            <!-- Phone -->
            <div>
              <label
                for="phone"
                class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2"
              >
                <span class="flex items-center gap-2">
                  <span class="material-symbols-outlined text-lg">phone</span>
                  Teléfono
                  <span class="text-red-500">*</span>
                </span>
              </label>
              <input
                type="tel"
                id="phone"
                th:field="*{phone}"
                class="w-full px-4 py-3 bg-white dark:bg-gray-800 border-2 border-gray-300 dark:border-gray-700 rounded-xl text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
                placeholder="Ingresa tu número de teléfono"
                pattern="^[+]?[0-9\-\s()]{7,20}$"
                title="Formato de teléfono válido (7-20 caracteres)"
                required
              />
              <p
                th:if="${#fields.hasErrors('phone')}"
                th:errors="*{phone}"
                class="mt-2 text-sm text-red-600 dark:text-red-400"
              ></p>
            </div>

            <!-- Address -->
            <div>
              <label
                for="address"
                class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2"
              >
                <span class="flex items-center gap-2">
                  <span class="material-symbols-outlined text-lg"
                    >location_on</span
                  >
                  Dirección de Entrega
                  <span class="text-xs font-normal text-gray-500"
                    >(Opcional)</span
                  >
                </span>
              </label>
              <textarea
                id="address"
                th:field="*{address}"
                rows="3"
                class="w-full px-4 py-3 bg-white dark:bg-gray-800 border-2 border-gray-300 dark:border-gray-700 rounded-xl text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all resize-none"
                placeholder="Ingresa tu dirección completa (necesaria para pedidos a domicilio)"
              ></textarea>
              <p class="mt-1 text-xs text-gray-600 dark:text-gray-400">
                Esta dirección se usará automáticamente para tus pedidos a
                domicilio
              </p>
              <p
                th:if="${#fields.hasErrors('address')}"
                th:errors="*{address}"
                class="mt-2 text-sm text-red-600 dark:text-red-400"
              ></p>
            </div>
          </div>

          <!-- Form Actions -->
          <div
            class="flex gap-4 mt-8 pt-6 border-t border-gray-200 dark:border-gray-800"
          >
            <button
              type="submit"
              class="flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-xl font-bold transition-all shadow-lg hover:shadow-xl"
            >
              <span class="material-symbols-outlined">save</span>
              Guardar Información
            </button>
            <a
              href="/client/dashboard"
              class="flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-gray-200 hover:bg-gray-300 dark:bg-gray-800 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-bold transition-all"
            >
              <span class="material-symbols-outlined">cancel</span>
              Cancelar
            </a>
          </div>
        </form>
      </div>

      <!-- CHANGE PASSWORD SECTION -->
      <div
        class="mt-6 rounded-2xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 shadow-xl overflow-hidden"
      >
        <!-- Password Form Header -->
        <div
          class="px-6 py-4 bg-gradient-to-r from-orange-500 to-orange-600 flex items-center gap-3"
        >
          <span class="material-symbols-outlined text-white text-3xl">
            lock
          </span>
          <h2 class="text-2xl font-bold text-white">Cambiar Contraseña</h2>
        </div>

        <!-- Password Form Body -->
        <form
          th:action="@{/client/profile/change-password}"
          th:object="${passwordDTO}"
          method="post"
          class="p-6 sm:p-8"
        >
          <div class="space-y-6">
            <!-- New Password -->
            <div>
              <label
                for="newPassword"
                class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2"
              >
                <span class="flex items-center gap-2">
                  <span class="material-symbols-outlined text-lg"
                    >lock_open</span
                  >
                  Nueva Contraseña
                  <span class="text-red-500">*</span>
                </span>
              </label>
              <input
                type="password"
                id="newPassword"
                th:field="*{newPassword}"
                class="w-full px-4 py-3 bg-white dark:bg-gray-800 border-2 border-gray-300 dark:border-gray-700 rounded-xl text-gray-900 dark:text-white focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all"
                placeholder="Ingresa tu nueva contraseña"
                minlength="6"
                required
              />
              <p class="mt-1 text-xs text-gray-600 dark:text-gray-400">
                Mínimo 6 caracteres
              </p>
              <p
                th:if="${#fields.hasErrors('newPassword')}"
                th:errors="*{newPassword}"
                class="mt-2 text-sm text-red-600 dark:text-red-400"
              ></p>
            </div>

            <!-- Confirm Password -->
            <div>
              <label
                for="confirmPassword"
                class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2"
              >
                <span class="flex items-center gap-2">
                  <span class="material-symbols-outlined text-lg"
                    >lock_reset</span
                  >
                  Confirmar Contraseña
                  <span class="text-red-500">*</span>
                </span>
              </label>
              <input
                type="password"
                id="confirmPassword"
                th:field="*{confirmPassword}"
                class="w-full px-4 py-3 bg-white dark:bg-gray-800 border-2 border-gray-300 dark:border-gray-700 rounded-xl text-gray-900 dark:text-white focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all"
                placeholder="Confirma tu nueva contraseña"
                minlength="6"
                required
              />
              <p class="mt-1 text-xs text-gray-600 dark:text-gray-400">
                Debe coincidir con la contraseña anterior
              </p>
              <p
                th:if="${#fields.hasErrors('confirmPassword')}"
                th:errors="*{confirmPassword}"
                class="mt-2 text-sm text-red-600 dark:text-red-400"
              ></p>
            </div>
          </div>

          <!-- Password Form Actions -->
          <div
            class="flex gap-4 mt-8 pt-6 border-t border-gray-200 dark:border-gray-800"
          >
            <button
              type="submit"
              class="flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-orange-500 hover:bg-orange-600 text-white rounded-xl font-bold transition-all shadow-lg hover:shadow-xl"
            >
              <span class="material-symbols-outlined">password</span>
              Cambiar Contraseña
            </button>
          </div>
        </form>
      </div>

      <!-- APPEARANCE SECTION (Theme Toggle) -->
      <div
        class="mt-6 rounded-2xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 shadow-xl overflow-hidden"
      >
        <!-- Theme Header -->
        <div
          class="px-6 py-4 bg-gradient-to-r from-purple-500 to-purple-600 flex items-center gap-3"
        >
          <span class="material-symbols-outlined text-white text-3xl">
            palette
          </span>
          <h2 class="text-2xl font-bold text-white">Apariencia</h2>
        </div>

        <!-- Theme Body -->
        <div class="p-6">
          <div
            class="flex items-center justify-between p-4 rounded-xl bg-gray-50 dark:bg-gray-800"
          >
            <div class="flex items-center gap-3">
              <span
                class="material-symbols-outlined text-2xl text-gray-700 dark:text-gray-300"
                id="profile-theme-icon"
              >
                light_mode
              </span>
              <div>
                <p class="font-semibold text-gray-900 dark:text-white">
                  Modo de Visualización
                </p>
                <p
                  class="text-sm text-gray-600 dark:text-gray-400"
                  id="profile-theme-description"
                >
                  Cambia entre modo claro y oscuro
                </p>
              </div>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input
                type="checkbox"
                id="profile-theme-switch"
                class="sr-only peer"
              />
              <div
                class="w-14 h-7 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 dark:peer-focus:ring-primary/40 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-primary"
              ></div>
            </label>
          </div>
        </div>
      </div>

      <!-- Account Info -->
      <div
        class="mt-6 rounded-xl bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 p-4"
      >
        <div class="flex items-start gap-3">
          <span
            class="material-symbols-outlined text-blue-600 dark:text-blue-400 text-2xl"
          >
            info
          </span>
          <div>
            <p class="font-semibold text-blue-800 dark:text-blue-300 mb-1">
              Información de la Cuenta
            </p>
            <ul class="text-sm text-blue-700 dark:text-blue-400 space-y-1">
              <li>• El nombre de usuario y teléfono deben ser únicos</li>
              <li>• El correo electrónico no se puede modificar</li>
              <li>
                • La dirección es necesaria para realizar pedidos a domicilio
              </li>
              <li>• Los campos marcados con * son obligatorios</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Script del Sistema de Temas -->
    <div th:replace="~{fragments/theme :: themeScript}"></div>

    <!-- Script para el switch de tema en perfil -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const themeSwitch = document.getElementById("profile-theme-switch");
        const themeIcon = document.getElementById("profile-theme-icon");
        const themeDescription = document.getElementById(
          "profile-theme-description"
        );

        // Leer tema actual de localStorage
        const currentTheme =
          localStorage.getItem("elgransazon-theme") || "light";

        // Configurar estado inicial del switch
        if (currentTheme === "dark") {
          themeSwitch.checked = true;
          themeIcon.textContent = "dark_mode";
          themeDescription.textContent = "Modo oscuro activado";
        } else {
          themeSwitch.checked = false;
          themeIcon.textContent = "light_mode";
          themeDescription.textContent = "Cambia entre modo claro y oscuro";
        }

        // Manejar cambio de tema
        themeSwitch.addEventListener("change", function () {
          if (this.checked) {
            // Activar modo oscuro
            document.documentElement.classList.add("dark");
            localStorage.setItem("elgransazon-theme", "dark");
            themeIcon.textContent = "dark_mode";
            themeDescription.textContent = "Modo oscuro activado";
          } else {
            // Activar modo claro
            document.documentElement.classList.remove("dark");
            localStorage.setItem("elgransazon-theme", "light");
            themeIcon.textContent = "light_mode";
            themeDescription.textContent = "Cambia entre modo claro y oscuro";
          }
        });
      });
    </script>

    <script th:inline="javascript">
      // Show SweetAlert on success or error
      /*<![CDATA[*/
      const successMessage = /*[[${successMessage}]]*/ null;
      const errorMessage = /*[[${errorMessage}]]*/ null;

      if (successMessage) {
        Swal.fire({
          icon: "success",
          title: "¡Éxito!",
          text: successMessage,
          confirmButtonColor: "#38e07b",
        });
      }

      if (errorMessage) {
        Swal.fire({
          icon: "error",
          title: "Error",
          text: errorMessage,
          confirmButtonColor: "#ef4444",
        });
      }
      /*]]>*/
    </script>
  </body>
</html>
