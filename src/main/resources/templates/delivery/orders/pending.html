<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>El Gran SazÃ³n - Pedidos a Repartir</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@300;400;500;600;700"
      rel="stylesheet"
    />

    <!-- Sistema de Temas (Modo Claro/Oscuro) -->
    <div th:replace="~{fragments/theme :: themeResources}"></div>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#38e07b",
              "primary-dark": "#2bc866",
              "background-light": "#f8faf9",
              "background-dark": "#0f1713",
            },
            fontFamily: {
              display: ["Work Sans"],
            },
          },
        },
      };
    </script>
    <style>
      .material-symbols-outlined {
        font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24;
      }

      body {
        font-family: "Work Sans", sans-serif;
      }

      /* Efecto de pedido listo - overlay verde mÃ¡s transparente */
      .card.ready::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(34, 197, 94, 0.08);
        z-index: 1;
        pointer-events: none;
      }

      /* Efecto de pedido en camino - overlay azul mÃ¡s transparente */
      .card.on-the-way::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(59, 130, 246, 0.08);
        z-index: 1;
        pointer-events: none;
      }

      /* Efecto de pedido entregado - overlay amarillo mÃ¡s transparente */
      .card.delivered::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(245, 158, 11, 0.08);
        z-index: 1;
        pointer-events: none;
      }

      /* AnimaciÃ³n para quitar el efecto */
      .card.removing-effect::before {
        animation: fadeOut 0.4s ease-out forwards;
      }

      .card.removing-effect {
        animation: borderFadeOut 0.4s ease-out forwards;
      }

      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }

      @keyframes borderFadeOut {
        from {
          border-color: currentColor;
        }
        to {
          border-color: #e5e7eb;
        }
      }
    </style>
  </head>
  <body
    class="bg-gradient-to-br from-background-light to-gray-50 dark:from-gray-900 dark:to-gray-950 font-display text-gray-800 dark:text-gray-100"
  >
    <div class="flex flex-col min-h-screen">
      <!-- Header -->
      <header
        class="bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 shadow-lg sticky top-0 z-30"
      >
        <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6">
          <div
            class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"
          >
            <div class="flex items-center gap-3 sm:gap-4">
              <a
                th:href="@{/delivery/dashboard}"
                class="flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
              >
                <span
                  class="material-symbols-outlined text-gray-600 dark:text-gray-300 text-xl sm:text-2xl"
                  >arrow_back</span
                >
              </a>
              <div>
                <h1
                  class="text-xl sm:text-2xl md:text-3xl font-bold text-gray-900 dark:text-white"
                >
                  ðŸ“¦ Pedidos a Repartir
                </h1>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                  Gestiona las entregas pendientes
                </p>
              </div>
            </div>
            <div
              class="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-primary-dark rounded-xl shadow-md"
            >
              <span class="material-symbols-outlined text-white"
                >local_shipping</span
              >
              <span class="text-white font-semibold">Modo Delivery</span>
            </div>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main
        class="flex-1 w-full max-w-screen-2xl px-4 py-6 mx-auto sm:px-6 lg:px-8"
      >
        <!-- Success Message -->
        <div
          th:if="${successMessage}"
          class="mb-6 bg-green-100 border-l-4 border-green-500 text-green-700 px-4 py-3 rounded-xl shadow-md"
        >
          <div class="flex items-center gap-2">
            <span class="material-symbols-outlined">check_circle</span>
            <p class="font-semibold" th:text="${successMessage}"></p>
          </div>
        </div>

        <!-- Error Message -->
        <div
          th:if="${errorMessage}"
          class="mb-6 bg-red-100 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded-xl shadow-md"
        >
          <div class="flex items-center gap-2">
            <span class="material-symbols-outlined">error</span>
            <p class="font-semibold" th:text="${errorMessage}"></p>
          </div>
        </div>

        <!-- Empty State -->
        <div
          th:if="${orders.isEmpty()}"
          class="flex flex-col items-center justify-center py-16 bg-white dark:bg-gray-900 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700"
        >
          <div
            class="w-24 h-24 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-800 rounded-2xl flex items-center justify-center mb-6"
          >
            <span
              class="material-symbols-outlined text-gray-400 dark:text-gray-500"
              style="font-size: 3rem"
              >inventory_2</span
            >
          </div>
          <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">
            No hay pedidos para repartir
          </h3>
          <p class="text-gray-600 dark:text-gray-400 text-center max-w-md">
            Cuando haya pedidos listos para entregar, aparecerÃ¡n aquÃ­.
          </p>
        </div>

        <!-- Orders Grid -->
        <div
          th:unless="${orders.isEmpty()}"
          class="grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4"
        >
          <div
            th:each="order : ${orders}"
            th:class="${order.status.name() == 'READY'} ? 'card ready bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 border-green-500 dark:border-green-600 rounded-3xl shadow-md hover:shadow-2xl transition-all duration-300 flex flex-col overflow-hidden relative h-[560px]' : (${order.status.name() == 'ON_THE_WAY'} ? 'card on-the-way bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 border-blue-500 dark:border-blue-600 rounded-3xl shadow-md hover:shadow-2xl transition-all duration-300 flex flex-col overflow-hidden relative h-[560px]' : (${order.status.name() == 'DELIVERED'} ? 'card delivered bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 border-yellow-500 dark:border-yellow-600 rounded-3xl shadow-md hover:shadow-2xl transition-all duration-300 flex flex-col overflow-hidden relative h-[560px]' : 'card bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-3xl shadow-md hover:shadow-2xl transition-all duration-300 flex flex-col overflow-hidden h-[560px]'))"
            th:data-order-id="${order.idOrder}"
          >
            <!-- Card Header -->
            <div
              class="p-5 px-6 flex justify-between items-center border-b border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 flex-shrink-0 relative z-[2]"
            >
              <div class="flex items-center gap-2">
                <span class="material-symbols-outlined text-primary text-2xl"
                  >receipt_long</span
                >
                <div>
                  <p class="text-sm font-bold text-gray-900 dark:text-white">
                    Pedido #<span th:text="${order.orderNumber}"></span>
                  </p>
                  <p class="text-xs text-gray-600 dark:text-gray-400">
                    <span th:text="${order.formattedCreatedAt}"></span>
                  </p>
                </div>
              </div>
              <span
                th:if="${order.status.name() == 'READY'}"
                class="status-badge ready"
              >
                <span class="material-symbols-outlined text-sm"
                  >check_circle</span
                >
                Listo
              </span>
              <span
                th:if="${order.status.name() == 'ON_THE_WAY'}"
                class="status-badge on-the-way"
              >
                <span class="material-symbols-outlined text-sm"
                  >local_shipping</span
                >
                En Camino
              </span>
              <span
                th:if="${order.status.name() == 'DELIVERED'}"
                class="status-badge delivered"
              >
                <span class="material-symbols-outlined text-sm">task_alt</span>
                Entregado
              </span>
            </div>

            <!-- Card Body -->
            <div
              class="p-5 flex-1 overflow-y-auto overflow-x-hidden relative z-[2] [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-track]:bg-gray-100 dark:[&::-webkit-scrollbar-track]:bg-gray-800 [&::-webkit-scrollbar-track]:rounded-full [&::-webkit-scrollbar-track]:my-2 [&::-webkit-scrollbar-thumb]:bg-gray-300 dark:[&::-webkit-scrollbar-thumb]:bg-gray-600 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-thumb:hover]:bg-gray-400 dark:[&::-webkit-scrollbar-thumb:hover]:bg-gray-500"
            >
              <!-- Customer Info -->
              <div
                class="mb-4 p-3 bg-blue-50 dark:bg-blue-950/30 rounded-xl border border-blue-200 dark:border-blue-800"
              >
                <h4
                  class="text-xs font-bold text-blue-900 dark:text-blue-300 mb-2 flex items-center gap-1"
                >
                  <span class="material-symbols-outlined text-sm">person</span>
                  Cliente
                </h4>
                <p
                  class="text-sm font-semibold text-gray-900 dark:text-white"
                  th:text="${order.customerName}"
                ></p>
                <p
                  class="text-xs text-gray-600 dark:text-gray-400 flex items-center gap-1 mt-1"
                >
                  <span
                    class="material-symbols-outlined"
                    style="font-size: 14px"
                    >phone</span
                  >
                  <span th:text="${order.customerPhone}"></span>
                </p>
              </div>

              <!-- Delivery Address -->
              <div
                class="mb-4 p-3 bg-green-50 dark:bg-green-950/30 rounded-xl border border-green-200 dark:border-green-800"
              >
                <h4
                  class="text-xs font-bold text-green-900 dark:text-green-300 mb-2 flex items-center gap-1"
                >
                  <span class="material-symbols-outlined text-sm"
                    >location_on</span
                  >
                  DirecciÃ³n de Entrega
                </h4>
                <p
                  class="text-sm text-gray-900 dark:text-white"
                  th:text="${order.deliveryAddress}"
                ></p>
                <p
                  th:if="${order.deliveryReferences != null and !order.deliveryReferences.isEmpty()}"
                  class="text-xs text-gray-600 dark:text-gray-400 mt-1 italic"
                >
                  Ref: <span th:text="${order.deliveryReferences}"></span>
                </p>
              </div>

              <!-- Order Items -->
              <div class="space-y-2">
                <h4
                  class="text-xs font-bold text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-1"
                >
                  <span class="material-symbols-outlined text-sm"
                    >restaurant</span
                  >
                  ArtÃ­culos del Pedido
                </h4>
                <div
                  th:each="detail : ${order.orderDetails}"
                  class="py-4 border-b border-gray-100 dark:border-gray-700 flex flex-col gap-2 last:border-b-0"
                >
                  <div class="flex justify-between items-start">
                    <div class="flex-1">
                      <p
                        class="text-sm font-semibold text-gray-900 dark:text-white"
                      >
                        <span
                          th:text="${detail.quantity} + 'x'"
                          class="text-primary font-bold"
                        ></span>
                        <span th:text="${detail.itemMenu.name}"></span>
                      </p>
                      <p
                        th:if="${detail.comments != null and !detail.comments.isEmpty()}"
                        class="text-xs text-gray-600 dark:text-gray-400 italic mt-1"
                      >
                        Nota: <span th:text="${detail.comments}"></span>
                      </p>
                    </div>
                    <p
                      class="text-sm font-bold text-gray-900 dark:text-white"
                      th:text="${detail.formattedSubtotal}"
                    ></p>
                  </div>
                </div>
              </div>

              <!-- Payment Info -->
              <div
                class="mt-4 pt-4 border-t-2 border-gray-200 dark:border-gray-700"
              >
                <div class="flex justify-between items-center mb-2">
                  <span class="text-sm text-gray-600 dark:text-gray-400"
                    >Subtotal:</span
                  >
                  <span
                    class="text-sm font-semibold text-gray-900 dark:text-white"
                    th:text="${order.formattedSubtotal}"
                  ></span>
                </div>
                <div class="flex justify-between items-center mb-2">
                  <span class="text-sm text-gray-600 dark:text-gray-400"
                    >IVA:</span
                  >
                  <span
                    class="text-sm font-semibold text-gray-900 dark:text-white"
                    th:text="${order.formattedTaxAmount}"
                  ></span>
                </div>
                <div class="flex justify-between items-center">
                  <span
                    class="text-base font-bold text-gray-900 dark:text-white"
                    >Total:</span
                  >
                  <span
                    class="text-lg font-bold text-primary"
                    th:text="${order.formattedTotal}"
                  ></span>
                </div>
                <div class="mt-2 flex items-center gap-2">
                  <span
                    class="material-symbols-outlined text-sm text-gray-600 dark:text-gray-400"
                    >payment</span
                  >
                  <span class="text-xs text-gray-600 dark:text-gray-400">
                    Pago:
                    <span
                      th:text="${order.paymentMethod.displayName}"
                      class="font-semibold"
                    ></span>
                  </span>
                </div>
              </div>
            </div>

            <!-- Card Footer -->
            <div
              class="p-5 bg-gray-50 dark:bg-gray-800/50 flex gap-3 justify-between border-t border-gray-100 dark:border-gray-700 flex-shrink-0 relative z-[2]"
            >
              <!-- Accept Button (READY -> ON_THE_WAY) -->
              <button
                th:if="${order.status.name() == 'READY'}"
                class="flex-1 py-3.5 px-6 text-base font-bold text-center text-white bg-gradient-to-r from-green-500 to-green-600 rounded-xl transition-all duration-300 flex items-center justify-center gap-2 border-0 cursor-pointer shadow-lg shadow-green-500/30 hover:-translate-y-0.5 hover:shadow-xl hover:shadow-green-500/40 active:translate-y-0 relative z-[2] btn-accept-delivery"
                th:data-order-id="${order.idOrder}"
                th:data-order-number="${order.orderNumber}"
              >
                <span class="material-symbols-outlined">local_shipping</span>
                Aceptar Entrega
              </button>

              <!-- Deliver Button (ON_THE_WAY -> DELIVERED) -->
              <button
                th:if="${order.status.name() == 'ON_THE_WAY'}"
                class="flex-1 py-3.5 px-6 text-base font-bold text-center text-white bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl transition-all duration-300 flex items-center justify-center gap-2 border-0 cursor-pointer shadow-lg shadow-purple-500/30 hover:-translate-y-0.5 hover:shadow-xl hover:shadow-purple-500/40 active:translate-y-0 relative z-[2] btn-mark-delivered"
                th:data-order-id="${order.idOrder}"
                th:data-order-number="${order.orderNumber}"
              >
                <span class="material-symbols-outlined">check_circle</span>
                Marcar como Entregado
              </button>

              <!-- Collect Payment Button (DELIVERED -> Payment Form) -->
              <!-- Solo efectivo - BotÃ³n habilitado -->
              <a
                th:if="${order.status.name() == 'DELIVERED' and order.paymentMethod.name() == 'CASH'}"
                th:href="@{/delivery/payments/form/{id}(id=${order.idOrder})}"
                class="flex-1 py-3.5 px-6 text-base font-bold text-center text-white bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-xl transition-all duration-300 flex items-center justify-center gap-2 border-0 cursor-pointer shadow-lg shadow-yellow-500/30 hover:-translate-y-0.5 hover:shadow-xl hover:shadow-yellow-500/40 active:translate-y-0 relative z-[2] no-underline"
              >
                <span class="material-symbols-outlined">payments</span>
                Cobrar Pedido
              </a>

              <!-- Otro mÃ©todo de pago - Mensaje informativo -->
              <div
                th:if="${order.status.name() == 'DELIVERED' and order.paymentMethod.name() != 'CASH'}"
                class="flex-1 py-3.5 px-6 text-sm font-semibold text-center text-gray-700 dark:text-gray-300 bg-gradient-to-r from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-800 rounded-xl flex items-center justify-center gap-2 border-2 border-gray-300 dark:border-gray-600 relative z-[2]"
                title="Este pedido no se puede cobrar porque no es en efectivo"
              >
                <span
                  class="material-symbols-outlined text-gray-500 dark:text-gray-400"
                  >block</span
                >
                <span>
                  Solo efectivo
                  <br />
                  <small
                    class="text-xs"
                    th:text="'Pago: ' + ${order.paymentMethod.displayName}"
                  ></small>
                </span>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script th:inline="javascript">
      /*<![CDATA[*/
      const currentRole = "delivery";
      /*]]>*/

      // Function to remove visual effect from card
      function removeCardEffect(orderId) {
        const card = document.querySelector(`[data-order-id="${orderId}"]`);
        if (card) {
          card.classList.add("removing-effect");
          setTimeout(() => {
            card.classList.remove(
              "ready",
              "on-the-way",
              "delivered",
              "removing-effect"
            );
          }, 400);
        }
      }

      // Generic function to change order status
      function changeOrderStatus(
        orderId,
        newStatus,
        title,
        text,
        confirmButtonText,
        successTitle,
        successText
      ) {
        Swal.fire({
          title: title,
          text: text,
          icon: "question",
          showCancelButton: true,
          confirmButtonColor: "#38e07b",
          cancelButtonColor: "#ef4444",
          confirmButtonText: confirmButtonText,
          cancelButtonText: "Cancelar",
          reverseButtons: true,
        }).then((result) => {
          if (result.isConfirmed) {
            // Remove visual effect immediately on confirmation
            removeCardEffect(orderId);

            fetch(
              `/${currentRole}/orders/${orderId}/change-status?newStatus=${newStatus}`,
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
              }
            )
              .then((response) => {
                if (response.ok) {
                  Swal.fire({
                    title: successTitle,
                    text: successText,
                    icon: "success",
                    confirmButtonColor: "#38e07b",
                    timer: 1500,
                    showConfirmButton: false,
                  }).then(() => {
                    window.location.reload();
                  });
                } else {
                  throw new Error("Error al cambiar el estado");
                }
              })
              .catch((error) => {
                console.error("Error:", error);
                Swal.fire({
                  title: "Error",
                  text: "No se pudo cambiar el estado del pedido",
                  icon: "error",
                  confirmButtonColor: "#38e07b",
                });
              });
          }
        });
      }

      // Event listeners
      document.addEventListener("DOMContentLoaded", function () {
        // Accept delivery buttons (READY -> ON_THE_WAY)
        document.querySelectorAll(".btn-accept-delivery").forEach((button) => {
          button.addEventListener("click", function () {
            const orderId = this.getAttribute("data-order-id");
            const orderNumber = this.getAttribute("data-order-number");
            changeOrderStatus(
              orderId,
              "ON_THE_WAY",
              "Â¿Aceptar esta entrega?",
              `Â¿EstÃ¡s seguro de aceptar el pedido #${orderNumber}?`,
              "SÃ­, aceptar",
              "Â¡Entrega aceptada!",
              `El pedido #${orderNumber} ahora estÃ¡ en camino.`
            );
          });
        });

        // Mark as delivered buttons (ON_THE_WAY -> DELIVERED)
        document.querySelectorAll(".btn-mark-delivered").forEach((button) => {
          button.addEventListener("click", function () {
            const orderId = this.getAttribute("data-order-id");
            const orderNumber = this.getAttribute("data-order-number");
            changeOrderStatus(
              orderId,
              "DELIVERED",
              "Â¿Marcar como entregado?",
              `Â¿Confirmas que el pedido #${orderNumber} fue entregado?`,
              "SÃ­, entregado",
              "Â¡Pedido entregado!",
              `El pedido #${orderNumber} ha sido marcado como entregado.`
            );
          });
        });

        // Remove auto-refresh since WebSocket handles real-time updates
        // setInterval(function () {
        //   window.location.reload();
        // }, 30000);
      });
    </script>

    <!-- WebSocket for Real-time Updates -->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <script>
      let stompClient = null;

      function connectDeliveryOrdersWebSocket() {
        const socket = new SockJS("/ws");
        stompClient = Stomp.over(socket);
        stompClient.debug = null;

        stompClient.connect(
          {},
          function (frame) {
            console.log("âœ… Delivery Orders WebSocket Connected");

            stompClient.subscribe(
              "/topic/admin/kitchen",
              function (notification) {
                const message = JSON.parse(notification.body);
                console.log(
                  "ðŸ“¦ Notification:",
                  message.type,
                  "Order ID:",
                  message.orderId
                );
                handleOrderUpdate(message);
              }
            );
          },
          function (error) {
            console.error("âŒ WebSocket Error:", error);
            setTimeout(connectDeliveryOrdersWebSocket, 5000);
          }
        );
      }

      function handleOrderUpdate(notification) {
        const orderId = notification.orderId;
        const newStatus = notification.newStatus;

        // Update specific order card badge
        const orderCard = document.querySelector(
          `[data-order-id="${orderId}"]`
        );
        if (orderCard && newStatus) {
          const badge = orderCard.querySelector(".status-badge");
          if (badge) {
            updateStatusBadge(badge, newStatus);

            // Update card border and overlay based on status
            updateCardAppearance(orderCard, newStatus);

            // Flash animation
            orderCard.style.transform = "scale(1.02)";
            setTimeout(() => {
              orderCard.style.transform = "scale(1)";
            }, 300);
          }
        }
      }

      function updateStatusBadge(badge, status) {
        // Remove all status classes
        badge.className = "status-badge";

        // Add new status class and text
        switch (status) {
          case "READY":
            badge.classList.add("ready");
            badge.innerHTML =
              '<span class="material-symbols-outlined">check_circle</span> Listo para entregar';
            break;
          case "ON_THE_WAY":
            badge.classList.add("on-the-way");
            badge.innerHTML =
              '<span class="material-symbols-outlined">local_shipping</span> En camino';
            break;
          case "DELIVERED":
            badge.classList.add("delivered");
            badge.innerHTML =
              '<span class="material-symbols-outlined">done_all</span> Entregado';
            break;
        }
      }

      function updateCardAppearance(card, status) {
        // Remove all status classes
        card.classList.remove("ready", "on-the-way", "delivered");

        // Add new status class
        switch (status) {
          case "READY":
            card.classList.add("ready");
            break;
          case "ON_THE_WAY":
            card.classList.add("on-the-way");
            break;
          case "DELIVERED":
            card.classList.add("delivered");
            break;
        }
      }

      // Connect on page load
      window.addEventListener(
        "DOMContentLoaded",
        connectDeliveryOrdersWebSocket
      );

      // Cleanup on page unload
      window.addEventListener("beforeunload", function () {
        if (stompClient) {
          stompClient.disconnect();
        }
      });
    </script>

    <!-- Script del Sistema de Temas -->
    <div th:replace="~{fragments/theme :: themeScript}"></div>
  </body>
</html>
